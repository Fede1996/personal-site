<!DOCTYPE html>
<html lang="it">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Passaporto Neurodivergente</title>
  <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">
  <link rel="stylesheet" href="assets/styles/passport.css">
</head>
<body class="section text-gray-900">

<header>
  <nav>
    <a href="badges.html">Progetto Neurodivergent League</a>
  </nav>
</header>

<section id="passportSection" class="min-h-screen py-12 px-6 flex flex-col justify-center items-center">
  <div class="max-w-4xl mx-auto text-center mb-8">
    <img src="assets/images/logo-neuro.png" alt="Logo Neurodivergent" class="h-16 mx-auto mb-2" />
    <h2 class="text-3xl font-bold mb-4">Passaporto neurodivergente</h2>
  </div>

  <div class="max-w-4xl mx-auto w-full">
    <div class="flex flex-col md:flex-row border border-gray-300 rounded-lg overflow-hidden shadow-lg bg-white">
      <!-- Colonna sinistra -->
      <div class="w-full md:w-2/5 p-4 flex items-center justify-center border-b md:border-b-0 md:border-r border-gray-300">
        <img src="assets/images/image_profile.png" alt="Foto profilo" class="h-24 md:h-32 rounded-full shadow-md" />
      </div>
      <!-- Colonna destra -->
      <div class="w-full md:w-3/5 p-6 text-left">
        <form class="space-y-4">
          <div>
            <label for="nome" class="block text-sm font-medium text-gray-700">Nome</label>
            <input type="text" id="nome" name="nome" placeholder="Nome" class="mt-1 block w-full border border-gray-300 rounded-md shadow-sm p-2 focus:outline-none focus:ring-2 focus:ring-purple-400" />
          </div>
          <div>
            <label for="cognome" class="block text-sm font-medium text-gray-700">Cognome</label>
            <input type="text" id="cognome" name="cognome" placeholder="Cognome" class="mt-1 block w-full border border-gray-300 rounded-md shadow-sm p-2 focus:outline-none focus:ring-2 focus:ring-purple-400" />
          </div>
          <div>
            <label for="sesso" class="block text-sm font-medium text-gray-700">Sesso</label>
            <select id="sesso" name="sesso" class="mt-1 block w-full border border-gray-300 rounded-md shadow-sm p-2 focus:outline-none focus:ring-2 focus:ring-purple-400">
              <option value="">Seleziona</option>
              <option>Maschio</option>
              <option>Femmina</option>
              <option>Non binario</option>
              <option>Altro / Preferisco non dire</option>
            </select>
          </div>
          <div>
            <label for="eta" class="block text-sm font-medium text-gray-700">EtÃ </label>
            <input type="number" id="eta" name="eta" placeholder="30" min="0" class="mt-1 block w-full border border-gray-300 rounded-md shadow-sm p-2 focus:outline-none focus:ring-2 focus:ring-purple-400" />
          </div>

          <!-- Galleria immagini -->
          <div class="mt-6">
            <h4 class="text-lg font-semibold mb-4">Seleziona le neurodivergenze</h4>
            <div id="imageGrid">
              <div class="img-container">
                <img src="assets/images/1.png" alt="Neurodivergenza 1" />
                <p class="img-desc">Discalculia</p>
              </div>
              <div class="img-container">
                <img src="assets/images/2.png" alt="Neurodivergenza 2" />
                <p class="img-desc">Mutismo selettivo</p>
              </div>
              <div class="img-container">
                <img src="assets/images/3.png" alt="Neurodivergenza 3" />
                <p class="img-desc">Disturbo borderline di personalitÃ </p>
              </div>
              <div class="img-container">
                <img src="assets/images/4.png" alt="Neurodivergenza 4" />
                <p class="img-desc">Persona altamente sensibile</p>
              </div>
              <div class="img-container">
                <img src="assets/images/5.png" alt="Neurodivergenza 5" />
                <p class="img-desc">Disprassia</p>
              </div>
              <div class="img-container">
                <img src="assets/images/6.png" alt="Neurodivergenza 6" />
                <p class="img-desc">Disgrafia</p>
              </div>
              <div class="img-container">
                <img src="assets/images/7.png" alt="Neurodivergenza 7" />
                <p class="img-desc">Sindrome di Tourette</p>
              </div>
              <div class="img-container">
                <img src="assets/images/8.png" alt="Neurodivergenza 8" />
                <p class="img-desc">Iperlessia</p>
              </div>
              <div class="img-container">
                <img src="assets/images/badge1.png" alt="Neurodivergenza 9" />
                <p class="img-desc">ADHD</p>
              </div>
              <div class="img-container">
                <img src="assets/images/badge2.png" alt="Neurodivergenza 10" />
                <p class="img-desc">Autismo Liv. 3</p>
              </div>
              <div class="img-container">
                <img src="assets/images/badge3.png" alt="Neurodivergenza 11" />
                <p class="img-desc">Dislessia</p>
              </div>
              <div class="img-container">
                <img src="assets/images/badge4.png" alt="Neurodivergenza 12" />
                <p class="img-desc">Autismo Liv. 1</p>
              </div>
              <div class="img-container">
                <img src="assets/images/badge5.png" alt="Neurodivergenza 13" />
                <p class="img-desc">Disturbo ossessivo compulsivo (OCD)</p>
              </div>
              <div class="img-container">
                <img src="assets/images/badge6.png" alt="Neurodivergenza 14" />
                <p class="img-desc">Disturbo dâ€™Ansia Generalizzata (GAD)</p>
              </div>
              <div class="img-container">
                <img src="assets/images/badge7.png" alt="Neurodivergenza 15" />
                <p class="img-desc">Disturbo bipolare</p>
              </div>
              <div class="img-container">
                <img src="assets/images/badge8.png" alt="Neurodivergenza 16" />
                <p class="img-desc">Sinestesia</p>
              </div>
              <div class="img-container">
                <img src="assets/images/badge-1.png" alt="Neurodivergenza 17" />
                <p class="img-desc">Emicrania cronaca</p>
              </div>
              <div class="img-container">
                <img src="assets/images/badge-2.png" alt="Neurodivergenza 18" />
                <p class="img-desc">Attacchi di panico</p>
              </div>
              <div class="img-container">
                <img src="assets/images/badge-3.png" alt="Neurodivergenza 19" />
                <p class="img-desc">Plusdotazione</p>
              </div>
              <div class="img-container">
                <img src="assets/images/badge-4.png" alt="Neurodivergenza 20" />
                <p class="img-desc">Stress</p>
              </div>
              <div class="img-container">
                <img src="assets/images/badge-5.png" alt="Neurodivergenza 21" />
                <p class="img-desc">Depressione</p>
              </div>
              <div class="img-container">
                <img src="assets/images/badge-6.png" alt="Neurodivergenza 22" />
                <p class="img-desc">Burnout</p>
              </div>
              <div class="img-container">
                <img src="assets/images/badge-7.png" alt="Neurodivergenza 23" />
                <p class="img-desc">Afasia</p>
              </div>
              <div class="img-container">
                <img src="assets/images/badge-8.png" alt="Neurodivergenza 24" />
                <p class="img-desc">Autismo Liv. 2</p>
              </div>
            </div>
          </div>

        </form>
      </div>
    </div>
  </div>
  <div style="height:10vh"></div>
  <button id="downloadPdfBtn" title="Scarica PDF">ðŸ“„ Scarica PDF</button>
</section>

<script src="https://unpkg.com/pdf-lib/dist/pdf-lib.min.js"></script>
  
<script>
  document.querySelectorAll('#imageGrid img').forEach(img => {
    img.addEventListener('click', () => {
      img.classList.toggle('colorful');
    });
  });
  
  document.getElementById("downloadPdfBtn").addEventListener("click", async () => {
  const { PDFDocument, StandardFonts, rgb } = PDFLib;

  const pdfDoc = await PDFDocument.create();
  const page = pdfDoc.addPage([595, 842]);
  const timesRomanFont = await pdfDoc.embedFont(StandardFonts.TimesRoman);

  // 1. Carica immagine profilo
  const imageUrl = 'assets/images/image_profile.png';
  const imageBytes = await fetch(imageUrl).then(res => res.arrayBuffer());
  const profileImage = await pdfDoc.embedPng(imageBytes);
  page.drawImage(profileImage, {
    x: 50, y: 700, width: 100, height: 100
  });

  // 2. Leggi dati form
  const nome = document.getElementById('nome').value || '---';
  const cognome = document.getElementById('cognome').value || '---';
  const sesso = document.getElementById('sesso').value || '---';
  const eta = document.getElementById('eta').value || '---';

  const textSize = 14;
  const lineHeight = 24;
  const startX = 170;
  let cursorY = 780;

  const drawText = (label, value) => {
    page.drawText(`${label}: ${value}`, {
      x: startX,
      y: cursorY,
      size: textSize,
      font: timesRomanFont,
      color: rgb(0, 0, 0),
    });
    cursorY -= lineHeight;
  };

  drawText('Nome', nome);
  drawText('Cognome', cognome);
  drawText('Sesso', sesso);
  drawText('EtÃ ', eta);

  // âœ… QUI: definisci selectedImages PRIMA di usarla
  const selectedImages = Array.from(document.querySelectorAll('#imageGrid img.colorful'));

  // Titolo sezione neurodivergenze
  cursorY -= 10;
  drawText('Neurodivergenze selezionate', '');

  // Inserisci immagini + testi
  for (const [index, img] of selectedImages.entries()) {
    const label = img.nextElementSibling?.textContent || `Badge ${index + 1}`;
    const imgSrc = img.src;

    const imgBytes = await fetch(imgSrc).then(res => res.arrayBuffer());
    const embeddedImg = imgSrc.endsWith('.png')
      ? await pdfDoc.embedPng(imgBytes)
      : await pdfDoc.embedJpg(imgBytes);

    const badgeWidth = 40;
    const badgeHeight = 40;
    const badgeX = startX + 20;
    const badgeY = cursorY - badgeHeight + 10;

    page.drawImage(embeddedImg, {
      x: badgeX,
      y: badgeY,
      width: badgeWidth,
      height: badgeHeight,
    });

    page.drawText(label, {
      x: badgeX + badgeWidth + 10,
      y: cursorY,
      size: textSize - 1,
      font: timesRomanFont,
      color: rgb(0.2, 0.2, 0.2),
    });

    cursorY -= badgeHeight + 10;
  }

  const pdfBytes = await pdfDoc.save();
  const blob = new Blob([pdfBytes], { type: 'application/pdf' });
  const url = URL.createObjectURL(blob);
  const link = document.createElement('a');
  link.href = url;
  link.download = 'passaporto_neurodivergente.pdf';
  link.click();
  URL.revokeObjectURL(url);
});

</script>

<footer class="footer">
  <div class="footer-content">
    <p>&copy; 2024 Federico Silvio Gorrino | Tutti i diritti riservati</p>
  </div>
</footer>

</body>
</html>
