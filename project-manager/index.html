<!DOCTYPE html>
<html lang="it">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Gestore Progetti</title>
    <link rel="stylesheet" href="styles.css">
    <link rel="manifest" href="manifest.json">
    <meta name="theme-color" content="#D32F2F">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
</head>

<body>
    <!-- LOGIN SCREEN -->
    <div id="login-screen" class="login-container">
        <div class="login-box">
            <img src="assets/logo.jpg" alt="Logo" class="login-logo">
            <h1>Gestionale Progetti</h1>
            <p>Accesso riservato</p>
            <button id="login-btn" class="google-btn">
                <svg width="18" height="18" viewBox="0 0 18 18" xmlns="http://www.w3.org/2000/svg">
                    <path
                        d="M17.64 9.2045c0-.6381-.0573-1.2518-.1636-1.8409H9v3.4814h4.8436c-.2086 1.125-.8427 2.0782-1.7959 2.7164v2.2581h2.9087c1.7018-1.5668 2.6836-3.874 2.6836-6.615z"
                        fill="#4285F4"></path>
                    <path
                        d="M9 18c2.43 0 4.4673-.806 5.9564-2.1805l-2.9087-2.2581c-.8059.54-1.8368.859-3.0477.859-2.344 0-4.3282-1.5831-5.036-3.7104H.9574v2.3318C2.4382 15.9832 5.4818 18 9 18z"
                        fill="#34A853"></path>
                    <path
                        d="M3.964 10.71c-.18-.54-.2822-1.1168-.2822-1.71s.1023-1.17.2823-1.71V4.9582H.9573C.3477 6.1732 0 7.5477 0 9s.3477 2.8268.9573 4.0418L3.964 10.71z"
                        fill="#FBBC05"></path>
                    <path
                        d="M9 3.5795c1.3214 0 2.5077.4541 3.4405 1.346l2.5813-2.5814C13.4632.8918 11.426 0 9 0 5.4818 0 2.4382 2.0168.9573 4.9582L3.964 7.29C4.6718 5.1627 6.6559 3.5795 9 3.5795z"
                        fill="#EA4335"></path>
                </svg>
                Entra con Google
            </button>
        </div>
    </div>

    <!-- MAIN APP (Hidden by default) -->
    <div id="app" class="hidden">
        <header class="app-header">
            <div class="logo-container">
                <img src="assets/logo.jpg" alt="Logo" class="app-logo">
                <h1>Project Manager</h1>
            </div>
            <button id="add-root-task-btn" class="fab" aria-label="Aggiungi Progetto">+</button>
        </header>

        <main id="task-list" class="task-list">
            <!-- Tasks will be rendered here -->
            <div class="empty-state">
                <p>Nessun progetto presente. Inizia aggiungendone uno!</p>
            </div>
        </main>

        <!-- Modal for Add/Edit Task -->
        <div id="task-modal" class="modal hidden">
            <div class="modal-content">
                <h2 id="modal-title">Nuovo Task</h2>
                <form id="task-form">
                    <input type="hidden" id="task-parent-id">
                    <input type="hidden" id="task-id">

                    <div class="form-group" id="code-generation-fields">
                        <label for="project-type">Tipo Progetto</label>
                        <select id="project-type">
                            <option value="" disabled selected>Caricamento...</option>
                        </select>

                        <label for="project-scope" style="margin-top:0.5rem">Ambito Progetto</label>
                        <select id="project-scope">
                            <option value="" disabled selected>Caricamento...</option>
                        </select>
                    </div>

                    <div class="form-group">
                        <label for="task-code">Codice (Autogenerato)</label>
                        <input type="text" id="task-code" readonly placeholder="Generato automaticamente..."
                            style="background:#f0f0f0; color:#555;">
                    </div>

                    <div class="form-group">
                        <label for="task-name">Nome</label>
                        <input type="text" id="task-name" required placeholder="Nome del task">
                    </div>

                    <div class="form-group">
                        <label for="task-desc">Descrizione</label>
                        <textarea id="task-desc" rows="3" placeholder="Descrizione dettagliata"></textarea>
                    </div>

                    <div class="form-group">
                        <label for="task-deadline">Deadline</label>
                        <input type="date" id="task-deadline" required>
                    </div>

                    <!-- Status is auto-calculated for parent tasks, selectable for leaf tasks? 
                         Req says: "un task non può essere verde se i sotto task non sono tutti verdi"
                         Implies manual contrl but validation on parents. Let's allow manual setting, 
                         but maybe disable 'green' if children are not green. 
                         For simplicity, user sets status, system validates/overrides or warns. 
                         Actually, standard for this type of app is leaf tasks have status, parent status is derived.
                         However, user asked: "un task non può essere verde se..." implies it CAN be set to green manually IF condition met.
                    -->
                    <div class="form-group">
                        <label for="task-status">Stato</label>
                        <select id="task-status" required>
                            <option value="red">Rosso (Bloccato/In Ritardo)</option>
                            <option value="yellow">Giallo (In Corso)</option>
                            <option value="green">Verde (Completato)</option>
                        </select>
                    </div>

                    <div class="modal-actions">
                        <button type="button" id="cancel-btn" class="btn btn-text">Annulla</button>
                        <button type="submit" class="btn btn-primary">Salva</button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <!-- Firebase SDK (Compat) -->
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-firestore-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-auth-compat.js"></script>

    <script src="js/app.js"></script>
    <script>
        if ('serviceWorker' in navigator && window.location.protocol !== 'file:') {
            navigator.serviceWorker.register('sw.js')
                .then(reg => console.log('SW registered', reg))
                .catch(err => console.error('SW failed', err));
        }
    </script>
</body>

</html>